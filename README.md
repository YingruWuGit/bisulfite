"clustering.py" and "bayesian_segment.py" contain the source code used for analyzing bisulfite accessible single-stranded DNA. For the details of our method and results, please refer to `A Bayesian model based computational analysis of the relationship between bisulfite accessible single-stranded DNA in chromatin and somatic hypermutation of immunoglobulin genes. Plos Computational Biology (2021)`.

# Clustering

This is an optional step. If the dataset contains sequences with different bisulfite accessible patches, then "clustering.py" is needed to divide the whole dataset into multiple groups.

In the "example" folder, the csv file "dsid_C_1461.csv" is a dataset needs to be divided into clusters. It's first column `id` is the id of each sequence and the last column `feq` is the frequency of each sequence. It's first row contains the location indices.

"clustering.py" needs two arguments:

- Line 2 is the path and name of the csv file.

- Line 3 is the cluster number.

It generates one csv file for each cluster with the same format, in the same folder.

# Bayesian Segmentation

"bayesian_segment.py" is used for detecting bisulfite accessible regions (BAR).

In the "example" folder, "dsid_C_1461_0.csv" is one of the clusters generated by "clustering.py".

"bayesian_segment.py" needs only one argument:

- Line 2 is the path and name of the csv file.

It generates "dsid_C_1461_0_res.csv" in the same folder. The "dsid_C_1461_0_res.csv" will have two additional rows:

- Row 2 `prob of change` is the posterior probability of a change occured at each site.

- Row 3 `prob of response` is the posterior response probability to bisulfite at each site.

It also outputs two graphs. One is the summary of data and posterior response rates, the other is the distribution of patch size, similar with those in our paper.

![alt text](https://github.com/YingruWuGit/bisulfite/blob/main/example/Figure_1.png)

In the above figure, the horizontal axis is the bp locations and the vertical axis is the response probabilities to bisulfite.

- Blue dots and lines are the means and standard deviations from raw data (dsid_C_1461_0.csv).

- Red dots are the posterior estimations from our Bayesian segmentation model.

![alt text](https://github.com/YingruWuGit/bisulfite/blob/main/example/Figure_2.png)

In the above figure, the blue bars are the patch size distribution.
